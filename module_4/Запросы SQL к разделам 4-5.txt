Задание 4.1

SELECT b.city,
       count(b.airport_code)
FROM dst_project.airports b
GROUP BY b.city
ORDER BY 2 DESC

Задание 4.2

Вопрос 1
SELECT count(DISTINCT f.status)
FROM dst_project.flights f

Вопрос 2
SELECT f.status,
       count(*) num
FROM dst_project.flights f
GROUP BY 1

Вопрос 3
SELECT s.aircraft_code,
       count(s.seat_no) num
FROM dst_project.seats s
GROUP BY 1
ORDER BY 1 DESC

Вопрос  4
SELECT f.status,
       count(*)
FROM dst_project.flights f
WHERE f.actual_arrival BETWEEN '2017-04-01'::date AND '2017-09-01'::date
GROUP BY 1
ORDER BY 1

Задание 4.3

Вопрос 1
select f.status, 
count(*)
from dst_project.flights f
group by 1
order by 1

Вопрос  2
SELECT f.status,
       count(*)
FROM dst_project.flights f
GROUP BY 1
ORDER BY 1

Вопрос 3
SELECT a.timezone,
       count(a.airport_code)
FROM dst_project.airports a
GROUP BY 1
ORDER BY 1

Вопрос 4
1). К сожалению, вот такой код не работает: (см. ниже). Не происходит сортировка по разности фактического и запланированного времени прибытия.
SELECT f.flight_id,
       (f.actual_arrival-f.scheduled_arrival) delta
FROM dst_project.flights f
ORDER BY delta DESC

2). В связи с чем сначала пришлось считать max(f.actual_arrival-f.scheduled_arrival), а затем писать вот такой запрос:
SELECT f.flight_id
FROM dst_project.flights f
WHERE (f.actual_arrival - f.scheduled_arrival)= '0 years 0 mons 0 days 5 hours 7 min 0.00 secs'

Задание 4.4.

Вопрос 1
SELECT f.actual_departure
FROM dst_project.flights f
ORDER BY 1

Вопрос 2
SELECT max(f.scheduled_arrival - f.scheduled_departure)
FROM dst_project.flights f

Вопрос 3
SELECT f.departure_airport,
       f.arrival_airport,
       (f.scheduled_arrival - f.scheduled_departure) delta
FROM dst_project.flights f
ORDER BY delta DESC
Вопрос 4
SELECT avg(f.scheduled_arrival - f.scheduled_departure)
FROM dst_project.flights f

Задание 4.5.

Вопрос 1
SELECT a.model,
       s.fare_conditions,
       count(*)
FROM dst_project.seats s
JOIN dst_project.aircrafts a ON s.aircraft_code=a.aircraft_code
GROUP BY  1,
                     2
ORDER BY 1

Вопрос 2
SELECT min(b.total_amount)
FROM dst_project.bookings b

Вопрос 3
SELECT t.passenger_id,
       b.seat_no
FROM dst_project.tickets t
JOIN dst_project.boarding_passes b ON t.ticket_no=b.ticket_no
WHERE t.passenger_id='4313 788533'

Задание 5.1.

Вопрос  1
SELECT count(*)
FROM dst_project.flights f
JOIN dst_project.airports a ON f.arrival_airport=a.airport_code
WHERE a.city='Anapa'
  AND date_trunc('year', f.actual_arrival)::date = '2017-01-01'

Вопрос 2
SELECT count(*)
FROM dst_project.flights f
JOIN dst_project.airports a ON f.departure_airport=a.airport_code
WHERE a.city='Anapa'
  AND (date_trunc('month', f.actual_departure)::date = '2017-01-01'
       OR date_trunc('month', f.actual_departure)::date = '2017-02-01'
       OR date_trunc('month', f.actual_departure)::date = '2017-12-01')

Вопрос 3
SELECT count(*)
FROM dst_project.flights f
JOIN dst_project.airports a ON f.departure_airport=a.airport_code
WHERE a.city='Anapa'
  AND f.status='Cancelled'

Вопрос 4
SELECT count(f.flight_id)
FROM dst_project.flights f
JOIN dst_project.airports a ON f.departure_airport=a.airport_code
WHERE a.city='Anapa'
  AND f.arrival_airport!='DME'
  AND f.arrival_airport!='SVO'
  AND f.arrival_airport!='VKO'

Вопрос 5
SELECT DISTINCT n.model,
                n.num
FROM
  (SELECT a.model,
          count(s.seat_no) num
   FROM dst_project.aircrafts a
   JOIN dst_project.seats s ON a.aircraft_code=s.aircraft_code
   GROUP BY 1) n
JOIN dst_project.aircrafts aa ON aa.model=n.model
JOIN dst_project.flights f ON aa.aircraft_code=f.aircraft_code
JOIN dst_project.airports a ON f.departure_airport=a.airport_code
WHERE a.city='Anapa'

